# Go AST Viewer - タスク定義書

## 文書情報

**バージョン**: 1.0  
**作成日**: 2025-11-23  
**関連文書**: [REQUIREMENTS.md](./REQUIREMENTS.md), [DESIGN.md](./DESIGN.md)

---

## タスク概要

本文書は、Go AST Viewerの実装に必要なタスクを段階的に定義する。各フェーズは論理的な依存関係に基づいて整理され、MVP（最小機能プロダクト）の完成を目指す。

### MVP範囲
- FR-001〜FR-006すべて必須
- ツリー表示とホバー表示の実装は最優先

---

## フェーズ1: プロジェクトセットアップ

### 1-1. プロジェクト初期化

- [x] プロジェクト初期化
  - 目的: 開発環境とビルドシステムの基盤を構築する
  - 詳細:
    - `npm init`でpackage.jsonを作成
    - 必要な依存関係をインストール（Svelte, Vite, TypeScript, Biome）
    - gitignoreの設定
  - 完了条件:
    - [x] package.jsonが作成されている
    - [x] node_modulesがインストールされている
    - [x] .gitignoreが適切に設定されている

- [x] TypeScript設定
  - 目的: TypeScriptコンパイラの設定を行う
  - 詳細:
    - tsconfig.jsonを作成
    - Svelte用の型定義を追加
    - strict modeを有効化
  - 完了条件:
    - [x] tsconfig.jsonが存在し、DESIGN.mdの仕様に従っている
    - [x] `tsc --noEmit`がエラーなく実行できる

- [x] Vite設定
  - 目的: ビルドツールとSvelteプラグインの設定を行う
  - 詳細:
    - vite.config.tsを作成
    - @sveltejs/vite-plugin-svelteを設定
    - vite-plugin-singlefileを設定
    - パスエイリアス（$lib）を設定
  - 完了条件:
    - [x] vite.config.tsが存在し、DESIGN.mdの仕様に従っている
    - [x] `npm run dev`で開発サーバーが起動する

- [x] Svelte設定
  - 目的: Svelteコンパイラの設定を行う
  - 詳細:
    - svelte.config.jsを作成
    - vitePreprocessを設定
    - ルーンモード（runes: true）を有効化
  - 完了条件:
    - [x] svelte.config.jsが存在し、DESIGN.mdの仕様に従っている
    - [x] Svelteファイルが正しくコンパイルされる

- [x] Biome設定
  - 目的: LinterとFormatterの設定を行う
  - 詳細:
    - biome.jsonを作成
    - 推奨ルールを適用
    - TypeScript/Svelte対応を設定
  - 完了条件:
    - [x] biome.jsonが存在し、DESIGN.mdの仕様に従っている
    - [x] `npm run lint`がエラーなく実行できる

---

## フェーズ2: Go WebAssembly パーサー実装

### 2-1. Go WASM開発環境構築

- [x] WASM開発環境構築
  - 目的: Go WebAssemblyのビルド環境を整備する
  - 詳細:
    - src/wasmディレクトリを作成
    - go.modを初期化
    - build.shスクリプトを作成
    - wasm_exec.jsのコピースクリプトを追加
  - 完了条件:
    - [x] src/wasm/build.shが実行可能
    - [x] `npm run build:wasm`が成功する
    - [x] public/parser.wasmとpublic/wasm_exec.jsが生成される

### 2-2. Goパーサー実装

- [x] 基本的なASTパーサー実装
  - 目的: Go言語のソースコードをASTに変換する機能を実装する
  - 詳細:
    - src/wasm/parser.goを作成
    - go/parser、go/astを使用してパース処理を実装
    - エラーハンドリングを実装
    - JavaScript呼び出し可能な関数をエクスポート
  - 完了条件:
    - [x] 有効なGo言語コードをASTに変換できる
    - [x] 構文エラー時に行番号・列番号を含むエラー情報を返す
    - [x] JavaScriptから呼び出し可能

- [x] ASTのJSON変換実装
  - 目的: GoのAST構造をJavaScriptで扱えるJSON形式に変換する
  - 詳細:
    - AST構造をJSONにシリアライズする関数を実装
    - ノードタイプ、位置情報、メタデータを含める
    - 子ノードの階層構造を保持
  - 完了条件:
    - [x] ASTが適切なJSON形式で出力される
    - [x] すべての主要なノードタイプが変換される
    - [x] 位置情報（pos, end）が正しく含まれる

### 2-3. WASM統合

- [x] WASM初期化処理実装
  - 目的: ブラウザでWASMを読み込み初期化する
  - 詳細:
    - src/lib/core/parser-bridge.tsを作成
    - WebAssembly.instantiateを使用してWASMロード
    - wasm_exec.jsの統合
    - 初期化完了フラグの管理
  - 完了条件:
    - [x] WASMが正常にロードされる
    - [x] 初期化完了を検知できる
    - [x] エラーハンドリングが適切

- [x] パーサーブリッジ実装
  - 目的: TypeScriptからWASMパーサーを呼び出すインターフェースを実装する
  - 詳細:
    - ParserBridgeクラスを実装
    - parse(sourceCode: string)メソッドを実装
    - エラーレスポンスと成功レスポンスの型定義
    - Promise-basedなAPI設計
  - 完了条件:
    - [x] TypeScriptからパーサーを呼び出せる
    - [x] 成功時にASTノードが返される
    - [x] エラー時にエラー情報が返される

---

## フェーズ3: 状態管理とコアロジック実装

### 3-1. Svelte Store実装

- [x] AST状態管理Store実装
  - 目的: AST関連の状態を管理するSvelte Storeを実装する
  - 詳細:
    - src/lib/stores/ast-store.tsを作成
    - astStore（現在のAST）を実装
    - parseErrorStore（パースエラー）を実装
    - selectedNodeStore（選択されたノード）を実装
    - expandedNodesStore（展開されたノードID）を実装
  - 完了条件:
    - [x] すべてのStoreが型定義されている
    - [x] Storeの購読と更新が機能する
    - [x] 型安全性が保証されている

- [x] エディタ状態管理Store実装
  - 目的: コードエディタの状態を管理するSvelte Storeを実装する
  - 詳細:
    - src/lib/stores/editor-store.tsを作成
    - ソースコード状態の管理
    - ハイライト範囲の管理
    - カーソル位置の管理
  - 完了条件:
    - [x] エディタ状態がStoreで管理されている
    - [x] リアクティブに状態が更新される

### 3-2. 位置マッピング実装

- [x] PositionMapper実装
  - 目的: ソースコード位置とASTノードの対応関係を管理する
  - 詳細:
    - src/lib/core/position-mapper.tsを作成
    - バイトオフセット → 行・列変換
    - 行・列 → バイトオフセット変換
    - 位置からASTノード検索
  - 完了条件:
    - [x] 位置変換が正確に機能する
    - [x] 指定位置のASTノードを取得できる
    - [x] 日本語コメントを含むコードでも正しく動作する

### 3-3. 型定義とユーティリティ

- [x] 共通型定義
  - 目的: プロジェクト全体で使用する型を定義する
  - 詳細:
    - src/lib/core/types.tsを作成
    - ASTNode型の定義
    - ParseResult型の定義
    - その他の共通型
  - 完了条件:
    - [x] すべての型がエクスポートされている
    - [x] 型の整合性が保たれている

- [x] 定数定義
  - 目的: プロジェクト全体で使用する定数を定義する
  - 詳細:
    - src/lib/utils/constants.tsを作成
    - デフォルト展開レベル
    - デバウンス時間
    - その他の定数
  - 完了条件:
    - [x] 定数が適切に定義されている
    - [x] マジックナンバーが排除されている

---

## フェーズ4: Svelteコンポーネント実装

### 4-1. 基本コンポーネント実装

- [x] App.svelteルートコンポーネント実装
  - 目的: アプリケーション全体のレイアウトを実装する
  - 詳細:
    - src/App.svelteを作成
    - ヘッダー、メインコンテンツ、ステータスバーのレイアウト
    - グローバルスタイルの適用
    - WASM初期化処理の呼び出し
  - 完了条件:
    - [x] レイアウトが適切に表示される
    - [x] WASM初期化が完了する
    - [x] 英語UIが適用されている

- [x] HeaderBar.svelte実装
  - 目的: ヘッダーバーとコントロールボタンを実装する
  - 詳細:
    - src/components/HeaderBar.svelteを作成
    - Parse Button（手動パース）
    - Expand All Button
    - Collapse All Button
  - 完了条件:
    - [x] すべてのボタンが表示される
    - [x] ボタンクリックで適切な処理が実行される

- [x] ErrorDisplay.svelte実装
  - 目的: パースエラーを表示するコンポーネントを実装する
  - 詳細:
    - src/components/ErrorDisplay.svelteを作成
    - parseErrorStoreを購読
    - エラーメッセージ、行・列番号の表示
    - クリアボタンの実装
  - 完了条件:
    - [x] エラー情報が適切に表示される
    - [x] エラー解消時に非表示になる

### 4-2. CodeEditorコンポーネント実装

- [x] CodeEditor基本実装
  - 目的: Go言語のソースコードを入力できるエディタを実装する
  - 詳細:
    - src/components/CodeEditor.svelteを作成
    - テキストエリアの実装
    - デフォルトコード（Hello World）の設定
    - 入力イベントのハンドリング
  - 完了条件:
    - [x] コードを入力できる
    - [x] デフォルトコードが表示される
    - [x] 複数行の入力に対応している

- [x] CodeEditorパース統合
  - 目的: コード変更時に自動的にパースを実行する
  - 詳細:
    - ParserBridgeとの統合
    - デバウンス処理（300ms）の実装
    - astStore、parseErrorStoreの更新
  - 完了条件:
    - [x] コード変更時にパースが実行される
    - [x] デバウンスが機能している
    - [x] パース結果がStoreに反映される

- [ ] CodeEditorシンタックスハイライト実装（推奨）
  - 目的: Go言語のシンタックスハイライトを実装する
  - 詳細:
    - ハイライト表示レイヤーの追加
    - 簡易的な正規表現ベースのハイライト
    - キーワード、文字列、コメントの色分け
  - 完了条件:
    - [ ] 基本的なシンタックスハイライトが機能する
    - [ ] パフォーマンスに問題がない

- [x] CodeEditorクリック連動機能実装
  - 目的: クリック・カーソル移動時に対応するASTノードを特定する
  - 詳細:
    - clickイベントとkeyupイベントのハンドリング
    - カーソル位置(selectionStart)の取得
    - PositionMapperを使用したノード特定
    - selectedNodeStoreの更新
  - 完了条件:
    - [x] クリック・カーソル移動で対応するASTノードが特定される
    - [x] selectedNodeStoreが更新される

### 4-3. ASTTreeViewコンポーネント実装

- [x] ASTTreeView基本実装
  - 目的: AST木構造を表示するコンテナコンポーネントを実装する
  - 詳細:
    - src/components/ASTTreeView.svelteを作成
    - astStoreの購読
    - Expand All / Collapse All機能
    - 空状態の表示
  - 完了条件:
    - [x] ASTが存在する場合にツリーが表示される
    - [x] 空状態が適切に表示される
    - [x] Expand/Collapse Allボタンが機能する

- [x] TreeNode再帰コンポーネント実装
  - 目的: ツリーノードを再帰的に表示するコンポーネントを実装する
  - 詳細:
    - src/components/TreeNode.svelteを作成
    - 再帰的なコンポーネント構造
    - 展開/折りたたみ状態の管理
    - ノードタイプの表示
    - クリックイベントのハンドリング
  - 完了条件:
    - [x] ツリーが階層的に表示される
    - [x] クリックで展開/折りたたみできる
    - [x] ノードタイプが表示される
    - [x] 展開状態がexpandedNodesStoreと同期する

- [x] TreeNode視覚的装飾実装
  - 目的: ツリーノードを見やすく装飾する
  - 詳細:
    - インデント表示の実装
    - 展開/折りたたみアイコン
    - ノードタイプごとの色分け
    - 選択ノードのハイライト
  - 完了条件:
    - [x] 階層が視覚的に理解できる
    - [x] アイコンが適切に表示される
    - [x] 色分けが機能している

### 4-4. 双方向ハイライト実装

- [x] ツリーノード自動展開機能実装
  - 目的: 選択されたノードまでの枝を自動的に展開する
  - 詳細:
    - selectedNodeStoreの変更を監視
    - ノードIDから親ノードのパスを取得
    - expandedNodesStoreに親ノードをすべて追加
  - 完了条件:
    - [x] 選択ノードが折りたたまれている場合、自動展開される
    - [x] 展開アニメーションがスムーズ
    - [x] パフォーマンスに問題がない

- [x] ツリーノードハイライト表示実装
  - 目的: 選択されたノードを視覚的に強調表示する
  - 詳細:
    - 選択ノードに専用CSSクラスを適用
    - スクロール位置を調整して選択ノードを表示
    - ハイライト色の設定
  - 完了条件:
    - [x] 選択ノードが明確に識別できる
    - [x] スクロール位置が適切に調整される
    - [x] 選択解除時にハイライトが消える

- [x] ソースコードハイライト機能実装
  - 目的: ASTツリーで選択されたノードに対応するソースコード範囲をハイライト表示する
  - 詳細:
    - highlightedRangeStoreの追加
    - CodeEditorでselectedNodeStoreを監視
    - 該当範囲を背景色でハイライト表示
    - textareaと重ねて表示するハイライトレイヤーの実装
  - 完了条件:
    - [x] ASTツリーでノード選択時、ソースコードの該当箇所がハイライトされる
    - [x] ハイライト範囲が正確
    - [x] ハイライト表示が視覚的に明確
    - [x] テキスト編集時もハイライトが適切に更新される
    - [x] パフォーマンスに問題がない

---

## フェーズ5: スタイリングとUI/UX改善

### 5-1. グローバルスタイル実装

- [x] グローバルスタイルシート作成
  - 目的: アプリケーション全体のスタイルを定義する
  - 詳細:
    - src/styles/global.cssを作成
    - リセットCSS
    - カラースキーム定義
    - フォント設定
    - レスポンシブ対応（デスクトップ優先）
  - 完了条件:
    - [x] 統一感のあるデザインが適用される
    - [x] デスクトップブラウザで見やすい

- [x] コンポーネント個別スタイル実装
  - 目的: 各Svelteコンポーネントのスタイルを実装する
  - 詳細:
    - 各.svelteファイルの`<style>`セクションを実装
    - BEM命名規則の適用
    - クリーンで見やすいレイアウト
  - 完了条件:
    - [x] すべてのコンポーネントが適切にスタイリングされている
    - [x] レイアウト崩れがない

### 5-2. UI/UX改善

- [x] レスポンシブレイアウト調整
  - 目的: ウィンドウサイズに応じた適切な表示を実現する
  - 詳細:
    - 2カラムレイアウトの調整
    - スプリッターの実装（オプション）
    - 最小幅の設定
  - 完了条件:
    - [x] ウィンドウリサイズに対応している
    - [x] 最小幅以下で崩れない

- [x] アクセシビリティ改善
  - 目的: キーボード操作やスクリーンリーダー対応を改善する
  - 詳細:
    - ARIA属性の追加
    - キーボードナビゲーション
    - フォーカス管理
  - 完了条件:
    - [x] キーボードで基本操作ができる
    - [x] ARIA属性が適切に設定されている

---

## フェーズ6: ビルドとデプロイメント

### 6-1. 単一HTMLファイル生成

- [ ] Viteビルド設定最適化
  - 目的: 単一HTMLファイルとして出力できるようにする
  - 詳細:
    - vite-plugin-singlefileの設定調整
    - アセットインライン化の確認
    - WASMバイナリのBase64エンコード
  - 完了条件:
    - [ ] `npm run build`で単一HTMLファイルが生成される
    - [ ] ファイルサイズが5MB以下
    - [ ] すべてのリソースがインライン化されている

- [ ] ビルド検証
  - 目的: 生成されたHTMLファイルが正常に動作することを確認する
  - 詳細:
    - ローカルでHTMLファイルを開いて動作確認
    - ネットワークトラフィックの確認（ゼロであること）
    - 全機能の動作確認
  - 完了条件:
    - [ ] ローカルで全機能が動作する
    - [ ] ネットワークリクエストが発生しない
    - [ ] エラーが発生しない

### 6-2. GitHub Actions設定

- [ ] GitHub Actionsワークフロー作成
  - 目的: GitHub Pagesへの自動デプロイを設定する
  - 詳細:
    - .github/workflows/deploy.ymlを作成
    - Node.js 20とGo 1.21の環境設定
    - WASMビルド → Viteビルド → デプロイのパイプライン
    - mainブランチへのpushトリガー
  - 完了条件:
    - [ ] ワークフローファイルが存在する
    - [ ] DESIGN.mdの仕様に従っている
    - [ ] ローカルでビルドが成功する

- [ ] GitHub Pages設定
  - 目的: GitHub Pagesでの公開を有効化する
  - 詳細:
    - リポジトリ設定でGitHub Pagesを有効化
    - GitHub Actionsからのデプロイ権限設定
    - カスタムドメイン設定（オプション）
  - 完了条件:
    - [ ] GitHub Pagesが有効化されている
    - [ ] デプロイ権限が設定されている
    - [ ] 公開URLが機能する

---

## フェーズ7: テストと品質保証

### 7-1. 単体テスト実装（推奨）

- [ ] Vitestセットアップ
  - 目的: テストフレームワークを設定する
  - 詳細:
    - Vitestと@testing-library/svelteのインストール
    - vitest.config.tsの作成
    - テストコマンドの追加
  - 完了条件:
    - [ ] Vitestが実行できる
    - [ ] テストコマンドが機能する

- [ ] Storeテスト実装
  - 目的: Svelte Storeの単体テストを実装する
  - 詳細:
    - ast-storeのテスト
    - editor-storeのテスト
    - Storeの購読・更新のテスト
  - 完了条件:
    - [ ] Storeのテストが実装されている
    - [ ] テストが合格する

- [ ] コアロジックテスト実装
  - 目的: ParserBridge、PositionMapperのテストを実装する
  - 詳細:
    - パース機能のテスト
    - 位置マッピングのテスト
    - エラーハンドリングのテスト
  - 完了条件:
    - [ ] コアロジックのテストが実装されている
    - [ ] カバレッジ70%以上

### 7-2. 統合テスト実装（推奨）

- [ ] コンポーネント統合テスト実装
  - 目的: コンポーネント間の連携をテストする
  - 詳細:
    - CodeEditor + ASTTreeViewのテスト
    - CodeEditor + HoverTooltipのテスト
    - TreeNode展開/折りたたみのテスト
  - 完了条件:
    - [ ] 統合テストが実装されている
    - [ ] テストが合格する

### 7-3. E2Eテスト実装（推奨）

- [ ] Playwrightセットアップ
  - 目的: E2Eテストフレームワークを設定する
  - 詳細:
    - Playwrightのインストール
    - playwright.config.tsの作成
    - テストブラウザの設定
  - 完了条件:
    - [ ] Playwrightが実行できる
    - [ ] 複数ブラウザでテストできる

- [ ] E2Eテストシナリオ実装
  - 目的: エンドツーエンドのシナリオをテストする
  - 詳細:
    - ページロード → デフォルトコード表示 → パース成功
    - コード入力 → AST更新
    - エラーコード入力 → エラー表示
    - ブラウザ互換性テスト（Chrome, Firefox, Safari, Edge）
  - 完了条件:
    - [ ] E2Eテストが実装されている
    - [ ] すべてのブラウザでテストが合格する

---

## フェーズ8: ドキュメント整備

### 8-1. ユーザードキュメント作成

- [ ] README.md作成
  - 目的: プロジェクトの概要と使い方を説明する
  - 詳細:
    - プロジェクト概要
    - デモリンク
    - 使用方法
    - 開発者向け情報
    - ライセンス情報
  - 完了条件:
    - [ ] README.mdが存在する
    - [ ] 初めて見る人が理解できる内容

- [ ] ライセンスファイル作成
  - 目的: MITライセンスを適用する
  - 詳細:
    - LICENSEファイルを作成
    - 著作権表示を追加
  - 完了条件:
    - [ ] LICENSEファイルが存在する
    - [ ] MITライセンスが適用されている

### 8-2. 開発者ドキュメント更新

- [ ] アーキテクチャドキュメント更新
  - 目的: 実装に基づいてDESIGN.mdを更新する
  - 詳細:
    - 実装と設計の差異を確認
    - DESIGN.mdの更新
    - コード例の更新
  - 完了条件:
    - [ ] DESIGN.mdが最新の実装を反映している
    - [ ] 差異が文書化されている

- [ ] コントリビューションガイド作成（オプション）
  - 目的: オープンソースプロジェクトとして貢献方法を明示する
  - 詳細:
    - CONTRIBUTING.mdの作成
    - 開発環境セットアップ手順
    - プルリクエストガイドライン
  - 完了条件:
    - [ ] CONTRIBUTING.mdが存在する
    - [ ] 貢献方法が明確

---

## タスク実行の推奨順序

1. **フェーズ1**: すべてのタスクを順番に実行（前提条件）
2. **フェーズ2**: すべてのタスクを順番に実行（AST解析の基盤）
3. **フェーズ3**: すべてのタスクを順番に実行（状態管理の基盤）
4. **フェーズ4**: 4-1 → 4-2 → 4-3 → 4-4の順で実行（UI実装）
5. **フェーズ5**: フェーズ4完了後に実行（見た目の改善）
6. **フェーズ6**: フェーズ5完了後に実行（デプロイ）
7. **フェーズ7**: フェーズ6と並行可能（品質保証）
8. **フェーズ8**: すべてのフェーズ完了後に実行（ドキュメント）

---

## 次のステップ

タスク定義が完了しました。実装を開始するには、以下のコマンドを実行してください:

```bash
# 特定のタスクを実行
/prj-exec-task [タスク名またはタスクID]

# フェーズ内のすべてのタスクを実行
/prj-exec-tasks --until=[タスク名またはタスクID]
```

**推奨される最初のタスク**: フェーズ1-1「プロジェクト初期化」から開始してください。

---

**文書バージョン**: 1.0  
**作成日**: 2025-11-23
